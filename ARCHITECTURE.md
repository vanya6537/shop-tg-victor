# 🏗️ Архитектура FlowHammer Shop

## 📐 СИСТЕМА ВЗАИМОДЕЙСТВИЯ

```
┌─────────────────────────────────────────────────────────┐
│                    TELEGRAM                             │
│                    (Клиенты & Администраторы)           │
│                                                          │
│  ┌─────────────┐         ┌────────────────────┐        │
│  │  /start     │         │   Обычный Юзер    │        │
│  │ выбор языка │◄────────┤   (Покупатель)    │        │
│  └─────────────┘         └────────────────────┘        │
│                                                          │
│  ┌────────────────────────────────────────────┐        │
│  │   Администраторы: @QValmont, @netslayer  │        │
│  │   /admin, /admin-dashboard, /admin-stats  │        │
│  └────────────────────────────────────────────┘        │
└───────────────────┬────────────────────────────────────┘
                    │
                    │ WEBHOOK / API
                    │
        ┌───────────▼────────────┐
        │    NODE.JS БОТ         │
        │  (bot/index.js)        │
        │                        │
        │ ✅ Обработка команд    │
        │ ✅ Отправка уведомлений│
        │ ✅ Управление заказами │
        └───────────┬────────────┘
                    │
        ┌───────────┴────────────────┐
        │                            │
        ▼                            ▼
    ┌──────────────┐          ┌─────────────────┐
    │   SQLite БД  │          │  i18n Система   │
    │  (orders.db) │          │  (РУ/EN/VI)    │
    │              │          │                 │
    │ • Заказы     │          │ • Локализация   │
    │ • Статусы    │          │ • Переводы      │
    │ • Клиенты    │          │ • Preferences   │
    └──────────────┘          └─────────────────┘
        │
        │ Данные
        │
        ▼
┌──────────────────────────────────────────────────────┐
│          TMA-ПРИЛОЖЕНИЕ (React)                │
│                                                       │
│  ┌────────────────────────────────────────┐         │
│  │  🏠 ГЛАВНОЕ МЕНЮ                       │         │
│  │  • Каталог товаров                     │         │
│  │  • Информация                          │         │
│  │  • Контакты                            │         │
│  │  • Выбор языка 🇷🇺/🇬🇧/🇻🇳           │         │
│  └────────────────────────────────────────┘         │
│                                                       │
│  ┌────────────────────────────────────────┐         │
│  │  🛒 МАГАЗИН                            │         │
│  │  • 4 товара с описанием                │         │
│  │  • Корзина покупок                     │         │
│  │  • Промокоды и скидки                  │         │
│  │  • Расчет доставки                     │         │
│  └────────────────────────────────────────┘         │
│                                                       │
│  ┌────────────────────────────────────────┐         │
│  │  /#admin - ПАНЕЛЬ АДМИНИСТРАТОРА      │         │
│  │  • Dashboard (метрики)                 │         │
│  │  • Управление заказами                │         │
│  │  • Анализ клиентов                    │         │
│  │  • Экспорт в CSV                       │         │
│  └────────────────────────────────────────┘         │
└──────────────────────────────────────────────────────┘
```

---

## 🔄 ПРОЦЕСС ЗАКАЗА

```
1. КЛИЕНТ ДЕЙСТВУЕТ
   │
   ├─► Выбирает товар в магазине
   │   (Корзина: товар + кол-во + цена)
   │
   ├─► Применяет промокод (если есть)
   │   (Скидка: -10% или -20$)
   │
   ├─► Вводит контактные данные
   │   (Имя, телефон, примечание)
   │
   └─► Нажимает "Оформить заказ"
       (Отправляет данные в WebApp)
        │
        ▼
2. БОТ ПОЛУЧАЕТ ДАННЫЕ
   │
   ├─► Парсит JSON от WebApp
   │
   ├─► Создает заказ в БД
   │   (INSERT в SQLite)
   │   ORDER_NUMBER: ORD_1234567890
   │
   ├─► Отправляет уведомление КЛИЕНТУ
   │   "✅ Спасибо! Номер заказа: ORD_..."
   │
   └─► Отправляет уведомление АДМИНУ
       "🛍️ НОВЫЙ ЗАКАЗ! (со всеми деталями)"
        │
        ▼
3. АДМИНИСТРАТОР УПРАВЛЯЕТ
   │
   ├─► Видит новый заказ в /orders
   │   или в веб-панели /#admin
   │
   ├─► Клик на заказ → видит детали
   │   (Товары, контакт, сумма)
   │
   ├─► Нажимает кнопку смены статуса
   │   ⏳ → ✅ → ⚙️ → 📦 → 🎉
   │
   └─► Система отправляет уведомление
       КЛИЕНТУ о каждом изменении
        │
        ▼
4. КЛИЕНТ ПОЛУЧАЕТ ОБНОВЛЕНИЯ
   │
   ├─► Notification: "Заказ подтвержден"
   │
   ├─► Notification: "Обработка началась"
   │
   ├─► Notification: "Отправлен в путь"
   │   (с трек-номером если добавлено)
   │
   └─► Notification: "Доставлен!"
       (/my-orders показывает 🎉 DELIVERED)
```

---

## 🔐 БЕЗОПАСНОСТЬ И ДОСТУПЫ

```
┌─────────────────────────────────────────┐
│    ВЕРАН-ИФИКАЦИЯ АДМИНИСТРАТОРА        │
│                                         │
│  1. ТЕЛЕЦтам ИМ:                       │
│     • @QValmont                         │
│     • @netslayer                        │
│     ↓                                   │
│     Проверка username в коде            │
│     ↓                                   │
│     Доступ к /admin команде ✅         │
│                                         │
│  2. ВЕБ-ПАНЕЛЬ:                        │
│     • Открыть /#admin                  │
│     • Ввести username                  │
│     ↓                                   │
│     Проверка против массива ADMIN_USERS│
│     ↓                                   │
│     Доступ к Dashboard ✅              │
│                                         │
│  3. БАЗЕ ДАННЫХ:                        │
│     • SQLite (локально)                │
│     • Шифрование на уровне приложения  │
│     • Бэкап-копия автоматических       │
│                                         │
└─────────────────────────────────────────┘
```

---

## 📊 СТРУКТУРА ДАННЫХ

### Таблица Orders в SQLite

```sql
CREATE TABLE orders (
  id                INTEGER PRIMARY KEY,      -- Уникальный ID
  order_number      TEXT UNIQUE,              -- ORD_1234567890
  user_id           INTEGER,                  -- Telegram ID
  username          TEXT,                     -- @username
  customer_name     TEXT,                     -- ФИ покупателя
  customer_contact  TEXT,                     -- Телефон/email
  customer_note     TEXT,                     -- Примечание
  items_json        TEXT,                     -- JSON массив товаров
  subtotal          REAL,                     -- Сумма
  currency          TEXT,                     -- USD/EUR/VND
  status            TEXT,                     -- pending/confirmed/...
  created_at        TIMESTAMP,                -- Когда создан
  updated_at        TIMESTAMP                 -- Когда обновлен
);
```

### JSON структура товаров

```json
[
  {
    "title": "Mini Pocket",
    "qty": 2,
    "price": 12.99,
    "lineTotal": 25.98
  },
  {
    "title": "Full Helmet Cover",
    "qty": 1,
    "price": 19.99,
    "lineTotal": 19.99
  }
]
```

---

## 🌐 ФАЙЛОВАЯ СТРУКТУРА

```
shop-tg/
├── 📁 bot/                          # Telegram Bot
│   ├── index.js                     # Основной файл бота
│   ├── database.js                  # SQLite операции
│   ├── admin-config.js              # Конфиг администраторов
│   ├── admin-utils.js               # Аналитика и статистика
│   ├── i18n.js                      # Система локализации
│   ├── user-languages.js            # Предпочтения языков
│   ├── orders.db                    # SQLite база данных
│   ├── locales/                     # Переводы
│   │   ├── en.json
│   │   ├── ru.json
│   │   └── vi.json
│   ├── package.json
│   ├── .env
│   └── ADMIN_SETUP.md
│
├── 📁 src/                          # React приложение
│   ├── components/
│   │   ├── AdminPanel.tsx           # 🆕 Панель администратора
│   │   ├── Header.tsx
│   │   ├── Hero.tsx
│   │   ├── Shop.tsx
│   │   ├── Booking.tsx
│   │   ├── About.tsx
│   │   ├── Footer.tsx
│   │   └── index.ts
│   ├── App.tsx                      # Основной компонент + роут #admin
│   ├── main.tsx
│   ├── i18n/
│   │   └── config.ts
│   ├── locales/
│   │   ├── en.json
│   │   ├── ru.json
│   │   └── vi.json
│   └── index.css
│
├── 📄 FEATURES_RU.md               # 🆕 Полный список возможностей
├── 📄 QUICK_REFERENCE.md           # 🆕 Шпаргалка
├── 📄 ADMIN_GUIDE.md               # Руководство админа
├── 📄 IMPLEMENTATION_SUMMARY.md     # Описание реализации
├── 📄 README.md
├── package.json
├── vite.config.ts
├── tsconfig.json
└── tailwind.config.cjs
```

---

## 📱 ВЕРСИИ И ИНТЕГРАЦИИ

```
┌─────────────────────────────────────┐
│   ИСПОЛЬЗУЕМЫЕ ТЕХНОЛОГИИ           │
│                                     │
│  Frontend:                          │
│  • React 18.2.0                     │
│  • TypeScript 5.0                   │
│  • Tailwind CSS 3.3                 │
│  • Framer Motion (анимации)        │
│  • i18next (локализация)           │
│  • Recharts (графики)              │
│                                     │
│  Backend:                           │
│  • Node.js + Express               │
│  • node-telegram-bot-api           │
│  • SQLite 3                         │
│  • dotenv (переменные)             │
│                                     │
│  DevOps:                            │
│  • Vite (сборка)                   │
│  • Git (версионирование)           │
│  • npm (пакеты)                    │
│                                     │
└─────────────────────────────────────┘
```

---

## 🎯 ТОЧКИ ВХОДА

| Точка Входа | URL | Кто | Функции |
|-------------|-----|-----|---------|
| 🌐 Главный сайт | `/` | Все | Каталог, инфо |
| 🛒 Магазин | `/#products` | Все | Товары, корзина |
| 🛡️ Админ-панель | `/#admin` | Админ | Управление |
| 🤖 Telegram бот | `t.me/BotName` | Все | Команды |
| 💬 Telegram вебапп | Встроенно | Все | Заказ |

---

## 📈 ПОТОК ДАННЫХ

```
Пользователь выбирает товар
        │
        ▼
    Корзина (Redux/Context)
        │
        ▼
    Клиент нажимает "Заказать"
        │
        ▼
    Telegram WebApp.sendData()
        │
        ▼
    Bot получает JSON
        │
        ├─► Парсит данные
        │
        ├─► Сохраняет в SQLite
        │
        ├─► Создает ORDER_NUMBER
        │
        └─► Отправляет уведомления
                │
                ├─► Клиенту (в Telegram)
                │
                └─► Администраторам
                    (в Telegram + веб-панель)
                    │
                    ▼
                Admin видит новый заказ
                    │
                    ├─► В Telegram (/orders)
                    │
                    └─► В веб-панели (/#admin)
                        │
                        ▼
                    Обновляет статус
                        │
                        ├─► БД обновляется
                        │
                        └─► Клиент получает уведомление
```

---

## 🔄 ЦИКЛ ЖИЗНИ ЗАКАЗА

```
СОЗДАНИЕ                    УПРАВЛЕНИЕ                   ЗАВЕРШЕНИЕ
    │                           │                            │
    ├─ ORD_создан              ├─ Подтвержден              ├─ Доставлен
    │  (⏳ PENDING)             │  (✅ CONFIRMED)            │  (🎉 DELIVERED)
    │                           │                            │
    ├─ БД запись                ├─ Админ обновляет           ├─ Уведомление отправлено
    │                           │                            │
    ├─ Уведомления              ├─ Клиент видит изменение    ├─ Завершено
    │                           │                            │
    └─ Ожидание обработки       └─ Продолжает движение       └─ Архив
```

---

*Диаграмма актуальна на 23.01.2026*
