const TelegramBot = require('node-telegram-bot-api');
require('dotenv').config();

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
const BOT_TOKEN = process.env.BOT_TOKEN;
const WEBAPP_URL = process.env.WEBAPP_URL || 'https://science-show.example.com';
const ORDERS_CHANNEL_ID = -5010977237; // ID –∫–∞–Ω–∞–ª–∞ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ BOT_TOKEN
if (!BOT_TOKEN) {
  console.error('‚ùå –û—à–∏–±–∫–∞: BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ!');
  console.error('–°–æ–∑–¥–∞–π —Ñ–∞–π–ª .env –≤ –ø–∞–ø–∫–µ bot/ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π BOT_TOKEN');
  process.exit(1);
}

// –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞
const bot = new TelegramBot(BOT_TOKEN, { polling: true });

// –•—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–≥–æ–≤ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ë–î)
const messageLogs = [];

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
const logMessage = (msg) => {
  const logEntry = {
    timestamp: new Date().toISOString(),
    chatId: msg.chat.id,
    chatType: msg.chat.type,
    chatTitle: msg.chat.title || msg.chat.username || 'Private Chat',
    userId: msg.from ? msg.from.id : 'channel_post',
    userName: msg.from ? (msg.from.username || `${msg.from.first_name} ${msg.from.last_name}`.trim()) : msg.chat.title,
    isBot: msg.from ? msg.from.is_bot : false,
    messageId: msg.message_id,
    text: msg.text || msg.caption || '[Non-text message]',
    messageType: msg.text ? 'text' : msg.photo ? 'photo' : msg.video ? 'video' : msg.document ? 'document' : 'other'
  };
  
  messageLogs.push(logEntry);
  
  // –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥ —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  console.log('\nüì® –ù–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï');
  console.log('‚îÄ'.repeat(60));
  console.log(`üìÖ –í—Ä–µ–º—è: ${logEntry.timestamp}`);
  console.log(`üí¨ –ö–∞–Ω–∞–ª/–ß–∞—Ç: ${logEntry.chatTitle} (${logEntry.chatType})`);
  console.log(`üÜî ID –ö–∞–Ω–∞–ª–∞/–ß–∞—Ç–∞: ${logEntry.chatId}`);
  console.log(`üë§ –û—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: @${logEntry.userName} (ID: ${logEntry.userId})${logEntry.isBot ? ' [–ë–û–¢]' : ''}`);
  console.log(`üìù –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è: ${logEntry.messageType}`);
  console.log(`üí≠ –¢–µ–∫—Å—Ç: ${logEntry.text.substring(0, 100)}${logEntry.text.length > 100 ? '...' : ''}`);
  console.log('‚îÄ'.repeat(60));
  
  // –õ–∏–º–∏—Ç –ª–æ–≥–æ–≤ –≤ –ø–∞–º—è—Ç–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000)
  if (messageLogs.length > 1000) {
    messageLogs.shift();
  }
};

console.log('ü§ñ Flow Hammer Shop Bot –∑–∞–ø—É—â–µ–Ω...');

// –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
bot.getMe().then((me) => {
  console.log(`‚úÖ –ë–æ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫: @${me.username}`);
  console.log(`üîê Bot ID: ${me.id}`);
  console.log(`üìù –ú–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª–∞—Ö: –î–∞ (–µ—Å–ª–∏ –±–æ—Ç - –∞–¥–º–∏–Ω –≤ –∫–∞–Ω–∞–ª–µ)`);
  console.log(`üí¨ –ú–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–∞—Ö: –î–∞`);
  console.log(`üîî –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–∫–ª—é—á–µ–Ω–æ!`);
  console.log('‚îÄ'.repeat(60));
}).catch(err => {
  console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞:', err);
});

// ‚ö†Ô∏è –í–ê–ñ–ù–û: –î–∞–Ω–Ω—ã–µ –∏–∑ Telegram.WebApp.sendData() –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ message.web_app_data
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram Mini App (–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
bot.on('message', async (msg) => {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Mini App (ReplyKeyboard —Å web_app)
  if (msg.web_app_data && msg.web_app_data.data) {
    console.log('\n‚ú®‚ú®‚ú® –ü–û–õ–£–ß–ï–ù–´ WEB_APP_DATA! ‚ú®‚ú®‚ú®');
    console.log('‚îÄ'.repeat(60));
    
    try {
      const data = JSON.parse(msg.web_app_data.data);
      console.log('üì¶ –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', JSON.stringify(data, null, 2));
      
      // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã order_v1
      const customer = data.customer || {};
      const cart = data.cart || {};
      const items = cart.items || [];
      const userId = msg.from.id;
      const username = msg.from.username || `${msg.from.first_name} ${msg.from.last_name}`.trim();
      const timestamp = data.timestamp;
      
      console.log('\n‚úâÔ∏è –ü–û–õ–£–ß–ï–ù–´ –î–ê–ù–ù–´–ï –ó–ê–ö–ê–ó–ê –ò–ó –í–ï–ë-–ü–†–ò–õ–û–ñ–ï–ù–ò–Ø');
      console.log('‚îÄ'.repeat(60));
      console.log('üë§ –ó–∞–∫–∞–∑—á–∏–∫:', customer.name);
      console.log('üìû –ö–æ–Ω—Ç–∞–∫—Ç:', customer.contact);
      console.log('üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:', customer.note);
      console.log('üõí –¢–æ–≤–∞—Ä–æ–≤ –≤ –∑–∞–∫–∞–∑–µ:', items.length);
      console.log('üí∞ –°—É–º–º–∞:', cart.subtotal, cart.currency);
      console.log('üïê –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', timestamp);
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã –≤ –∫—Ä–∞—Å–∏–≤—ã–π —Å–ø–∏—Å–æ–∫
      let itemsList = '';
      items.forEach((item, idx) => {
        itemsList += `${idx + 1}. *${item.title}*\n`;
        itemsList += `   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${item.qty}\n`;
        itemsList += `   –¶–µ–Ω–∞: $${item.lineTotal}\n\n`;
      });
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–∞–Ω–∞–ª–∞ –∑–∞–∫–∞–∑–æ–≤
      const orderMessage = `üõçÔ∏è *–ù–û–í–´–ô –ó–ê–ö–ê–ó!*

üìù *–î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—á–∏–∫–∞:*
üë§ –ò–º—è: ${customer.name || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
üìû –ö–æ–Ω—Ç–∞–∫—Ç: ${customer.contact || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
üë• Telegram: @${username} (ID: ${userId})

üì¶ *–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ:*
${itemsList}
üí∞ *–ò—Ç–æ–≥–æ: $${cart.subtotal} ${cart.currency}*

üìã *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:*
${customer.note || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}

‚è∞ –í—Ä–µ–º—è –ø–æ–¥–∞—á–∏ –∑–∞–∫–∞–∑–∞: ${new Date(timestamp).toLocaleString('ru-RU')}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚úÖ –ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ`;
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∫–∞–Ω–∞–ª –∑–∞–∫–∞–∑–æ–≤
      await bot.sendMessage(ORDERS_CHANNEL_ID, orderMessage, { parse_mode: 'Markdown' });
      console.log(`‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª ${ORDERS_CHANNEL_ID}`);
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —é–∑–µ—Ä—É –≤ –ª–∏—á–∫—É
      await bot.sendMessage(msg.chat.id, 
        `‚úÖ *–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑, ${customer.name || '–¥—Ä—É–∂–µ'}!*\n\n` +
        `–ú—ã –ø–æ–ª—É—á–∏–ª–∏ –≤–∞—à –∑–∞–∫–∞–∑ –Ω–∞ —Å—É–º–º—É *$${cart.subtotal} ${cart.currency}*\n\n` +
        `üì¶ *–¢–æ–≤–∞—Ä—ã:*\n${itemsList}\n` +
        `–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø–æ –Ω–æ–º–µ—Ä—É *${customer.contact}* –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞\n\n` +
        `–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: \`ORDER_${msg.message_id}\``,
        { parse_mode: 'Markdown' }
      );
      console.log(`‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${username}`);
      console.log('‚îÄ'.repeat(60));
      return; // –ù–µ –ª–æ–≥–∏—Ä—É–µ–º web_app_data –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ web_app_data:', error);
      await bot.sendMessage(msg.chat.id, 
        '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–∫–∞–∑–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
        { parse_mode: 'Markdown' }
      );
      return;
    }
  }
  
  // –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–æ–≤, –≥—Ä—É–ø–ø, —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤
  if (msg.chat.type === 'channel' || msg.chat.type === 'supergroup' || msg.chat.type === 'group' || msg.chat.type === 'private') {
    logMessage(msg);
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å—Ç–æ–≤ –≤ –∫–∞–Ω–∞–ª–µ (channel_post –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–æ–≥–¥–∞ –∞–¥–º–∏–Ω/—Å–æ–∑–¥–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –≤ –∫–∞–Ω–∞–ª)
bot.on('channel_post', (msg) => {
  console.log('üì¢ –ü–æ–ª—É—á–µ–Ω channel_post –∏–∑ –∫–∞–Ω–∞–ª–∞:', msg.chat.title);
  logMessage(msg);
});

// –ö–æ–º–∞–Ω–¥–∞ /start - —Å–º–µ—à–∞–Ω–Ω–æ–µ –º–µ–Ω—é (ReplyKeyboard + Inline)
bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;
  
  // –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º ReplyKeyboard —Å web_app –∫–Ω–æ–ø–∫–∞–º–∏
  const replyKeyboard = {
    reply_markup: {
      keyboard: [
        [
          {
            text: 'üõí –ú–∞–≥–∞–∑–∏–Ω',
            web_app: { url: WEBAPP_URL }
          },
          {
            text: 'üõí –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',
            web_app: { url: `${WEBAPP_URL}#booking` }
          }
        ]
      ],
      resize_keyboard: true
    }
  };

  const inlineKeyboard = {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: 'üõçÔ∏è –¢–æ–≤–∞—Ä—ã',
            callback_data: 'products_list'
          },
          {
            text: 'üí¨ –ö–æ–Ω—Ç–∞–∫—Ç—ã',
            callback_data: 'contact_info'
          }
        ]
      ]
    }
  };

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å inline –∫–Ω–æ–ø–∫–∞–º–∏
  bot.sendMessage(chatId, 
    'üõçÔ∏è *FLOW HAMMER SHOP DA NANG*\n\n' +
    '‚ú® –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–∞—Å—Å–∞–∂–Ω—ã–µ –ø–∞–ª–∫–∏ & —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –Ω–∞—à–ª–µ–º–Ω–∏–∫\n' +
    'üí™ –î–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤, –π–æ–≥–æ–≤, –≤–æ–¥–∏—Ç–µ–ª–µ–π ‚Äî –¥–ª—è –≤–∞—Å!\n\n' +
    '‚≠ê *–¢—Ä–µ–Ω–¥–æ–≤–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.*\n\n' +
    '–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞—à–∏ —Ö–µ–¥–ª–∞–π–Ω–µ—Ä—ã –∏ –Ω–∞–π–¥–∏ —Å–≤–æ—é –∏–¥–µ–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É:', 
    inlineKeyboard
  );
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å web_app –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  bot.sendMessage(chatId,
    'üõí –û—Ç–∫—Ä–æ–π –∫–∞—Ç–∞–ª–æ–≥ –∏–ª–∏ –æ—Ñ–æ—Ä–º–∏ –∑–∞–∫–∞–∑:',
    replyKeyboard
  );
});

// –ö–æ–º–∞–Ω–¥–∞ /help
bot.onText(/\/help/, (msg) => {
  const chatId = msg.chat.id;
  bot.sendMessage(chatId,
    'üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n' +
    '/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n' +
    '/products - –ù–∞—à–∏ —Ç—Ä–∏ –∑–≤—ë–∑–¥—ã (–º–∞—Å—Å–∞–∂–Ω—ã–µ –ø–∞–ª–∫–∏)\n' +
    '/trust - –ü–æ—á–µ–º—É –≤–∞–º —Å—Ç–æ–∏—Ç –Ω–∞–º –≤–µ—Ä–∏—Ç—å\n' +
    '/book - –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑\n' +
    '/contact - –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n' +
    '/logs - –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π\n' +
    '/logs-clear - –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏\n' +
    '/status - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞\n' +
    '/help - –°–ø—Ä–∞–≤–∫–∞'
  );
});

// –ö–æ–º–∞–Ω–¥–∞ /products - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä—ë—Ö —Ö–µ–¥–ª–∞–π–Ω–µ—Ä—Å–∫–∏—Ö –ø–∞–ª–∫–∞—Ö
bot.onText(/\/products/, (msg) => {
  const chatId = msg.chat.id;
  const productsMessage = 
    'üõçÔ∏è *–¢–†–ò –ó–í–ï–ó–î–´ –ù–ê–®–ï–ì–û –ú–ê–ì–ê–ó–ò–ù–ê*\n\n' +
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
    'üßä *–ö–û–ú–ü–ê–ö–¢–ù–ê–Ø: Mini Pocket (12.99$)*\n' +
    'üìè –î–ª–∏–Ω–∞: 10 —Å–º ‚Äî –≤ —Å—É–º–∫—É, –≤ –∫–∞—Ä–º–∞–Ω\n' +
    '‚ú® –ò–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è: –æ—Ñ–∏—Å–∞, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π, –±—ã—Å—Ç—Ä—ã—Ö —Å–µ—Å—Å–∏–π\n' +
    'üí™ –ú–∞—Ç–µ—Ä–∏–∞–ª: –ø–ª–∞—Å—Ç–∏–∫ ABS + —Å–∏–ª–∏–∫–æ–Ω\n' +
    '‚≠ê –¢–µ—Ö–Ω–∏–∫–∞: —É–¥–æ–±–Ω–∞—è –≤ –ª–∞–¥–æ–Ω–∏\n\n' +
    'üíÜ *–°–†–ï–î–ù–Ø–Ø: Therapy Ergonomic (24.99$)*\n' +
    'üìè –î–ª–∏–Ω–∞: 30 —Å–º ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è\n' +
    '‚ú® –ò–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è: –¥–æ–º–∞, —Å–ø–æ—Ä—Ç–∑–∞–ª–∞, –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n' +
    'üí™ –ú–∞—Ç–µ—Ä–∏–∞–ª: –≥–∏–±–∫–∏–π –∫–æ—Ä–ø—É—Å + –º—è–≥–∫–∏–π –Ω–∞–∫–æ–Ω–µ—á–Ω–∏–∫\n' +
    '‚≠ê –¢–µ—Ö–Ω–∏–∫–∞: —Ç–æ—á–Ω–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ —Ç—Ä–∏–≥–≥–µ—Ä-—Ç–æ—á–∫–∏\n\n' +
    'ü•á *–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø: Acupressure Pro (19.99$)*\n' +
    'üìè –î–ª–∏–Ω–∞: 45 —Å–º ‚Äî –¥–ª—è —Å–µ—Ä—å—ë–∑–Ω–æ–π —Ä–∞–±–æ—Ç—ã\n' +
    '‚ú® –ò–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è: –≥–ª—É–±–æ–∫–æ–≥–æ –º–∞—Å—Å–∞–∂–∞, —Å–ø–∏–Ω—ã, –Ω–æ–≥\n' +
    'üí™ –ú–∞—Ç–µ—Ä–∏–∞–ª: —Ö–∞—Ä–¥–∫–æ—Ä–Ω—ã–π ABS + –∂—ë—Å—Ç–∫–∏–π —Å–∏–ª–∏–∫–æ–Ω\n' +
    '‚≠ê –¢–µ—Ö–Ω–∏–∫–∞: —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—É–ø—Ä–µ—Å—Å—É—Ä–∞\n\n' +
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
    'üéØ *–ü–õ–Æ–°: Character Helmet Cover (8.99$)*\n' +
    'üòä –ú–∏–ª—ã–π –¥–∏–∑–∞–π–Ω full-face –¥–ª—è –º–æ—Ç–æ—Ü–∏–∫–ª–∏—Å—Ç–æ–≤\n' +
    'üõ°Ô∏è –ó–∞—â–∏—Ç–∞ —à–ª–µ–º–∞ + —Å—Ç–∏–ª—å –Ω–∞ —Ñ–æ—Ç–æ\n\n' +
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
    '‚úÖ *3000+ –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤*\n' +
    '‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ 30 –¥–Ω–µ–π\n' +
    '‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑\n\n' +
    '–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É!';
  
  const keyboard = {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: 'üõí –û—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω',
            web_app: { url: `${WEBAPP_URL}#products` }
          }
        ]
      ]
    }
  };

  bot.sendMessage(chatId, productsMessage, { parse_mode: 'Markdown', ...keyboard });
  
  // Send helmet cover image - try with a simpler approach
  console.log('üì∏ –û—Ç–ø—Ä–∞–≤–ª—è—é —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞...');
  try {
    // Using the real helmet cover image
    const helmetImageUrl = 'https://i.ibb.co/mrBvbTL5/2026-01-23-03-55-03.jpg';
    bot.sendPhoto(chatId, helmetImageUrl, {
      caption: 'üß∏ *Character Helmet Cover - –°—Ç–∏–ª—å & –ó–∞—â–∏—Ç–∞*\nüíô –ú–∏–ª—ã–π –¥–∏–∑–∞–π–Ω | ‚ú® –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ\nüèçÔ∏è –î–ª—è –º–æ—Ç–æ—Ü–∏–∫–ª–∏—Å—Ç–æ–≤ | üí∞ 8.99$',
      parse_mode: 'Markdown'
    }).then(msg => {
      console.log('‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (ID: ' + msg.photo[0].file_id + ')');
    }).catch(err => {
      console.error('‚ùå –û—à–∏–±–∫–∞ —Ñ–æ—Ç–æ:', err.message);
      // Fallback: send text description if photo fails
      bot.sendMessage(chatId, 'üß∏ *Character Helmet Cover*\nüíô –ú–∏–ª—ã–π –¥–∏–∑–∞–π–Ω full-face —à–ª–µ–º–∞\nüí∞ –¶–µ–Ω–∞: 8.99$', { parse_mode: 'Markdown' });
    });
  } catch (e) {
    console.error('‚ùå Exception:', e.message);
  }
});

// –ö–æ–º–∞–Ω–¥–∞ /trust - –¥–æ–≤–µ—Ä–∏–µ –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥
bot.onText(/\/trust/, (msg) => {
  const chatId = msg.chat.id;
  const trustMessage = 
    'üíé *–ü–û–ß–ï–ú–£ –ú–´ ‚Äî –í–ê–® –í–´–ë–û–†*\n\n' +
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
    'üèÜ *–≠–ö–°–ü–ï–†–¢ –í –î–ï–õ–ï*\n' +
    '–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—à–ª–∞ —Ç—Ä–µ–Ω–∏–Ω–≥–∏ –≤ –¢–∞–∏–ª–∞–Ω–¥–µ –∏ –í—å–µ—Ç–Ω–∞–º–µ.\n' +
    '–ö–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–∏—á–Ω–æ.\n\n' +
    '‚≠ê *–û–¢–ó–´–í–´ –†–ï–ê–õ–¨–ù–´–• –õ–Æ–î–ï–ô*\n' +
    '"–ü–∞–ª–∫–∞ –ø–æ–º–æ–≥–ª–∞ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –±–æ–ª–∏ –≤ —Å–ø–∏–Ω–µ!" ‚Äî –ú–∞—Ä–∏—è\n' +
    '"–ë–µ—Ä—É –≤–µ–∑–¥–µ —Å —Å–æ–±–æ–π, —Å–ø–∞—Å–∞–µ—Ç –æ—Ç —Å—Ç—Ä–µ—Å—Å–∞!" ‚Äî –¢–æ–º\n' +
    '"–ö–∞—á–µ—Å—Ç–≤–æ ‚Äî –≤—ã—à–µ –≤—Å—è–∫–∏—Ö –ø–æ—Ö–≤–∞–ª!" ‚Äî –ê–Ω–Ω–∞\n\n' +
    'üîê *–î–û–í–ï–†–ò–ï = –ö–ê–ß–ï–°–¢–í–û*\n' +
    '‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–Ω–µ —Ç–æ–∫—Å–∏—á–Ω—ã)\n' +
    '‚úÖ –ü—Ä–æ—à–ª–∏ –¥–µ—Ä–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã\n' +
    '‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º\n\n' +
    'üí∞ *–°–ü–†–ê–í–ï–î–õ–ò–í–ê–Ø –¶–ï–ù–ê*\n' +
    '–ü—Ä—è–º—ã–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è = –º–∏–Ω–∏–º—É–º –Ω–∞—Ü–µ–Ω–∫–∏.\n' +
    '–ü—Ä–æ–º–æ–∫–æ–¥ WELCOME10 –¥–∞—ë—Ç –≤–∞–º 10% –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑.\n\n' +
    'üöÄ *–ë–´–°–¢–†–û –ò –£–î–û–ë–ù–û*\n' +
    'üì¶ –î–æ—Å—Ç–∞–≤–∫–∞ –≤ Da Nang –∑–∞ 24-48 —á–∞—Å–æ–≤\n' +
    'üì¶ –ü–æ –í—å–µ—Ç–Ω–∞–º—É: 2-3 –¥–Ω—è\n' +
    'üì¶ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ disponible\n\n' +
    '‚ù§Ô∏è *–ì–ê–†–ê–ù–¢–ò–Ø 30 –î–ù–ï–ô*\n' +
    '–ù–µ –¥–æ–≤–æ–ª–µ–Ω ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ–Ω—å–≥–∏, –±–µ–∑ –≤–æ–ø—Ä–æ—Å–æ–≤.\n\n' +
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
    '–î–∞–≤–∞–π –Ω–∞—á–Ω—ë–º —Ç–≤–æ–π –ø—É—Ç—å –∫ –∑–¥–æ—Ä–æ–≤—å—é! üí™';
  
  bot.sendMessage(chatId, trustMessage, { parse_mode: 'Markdown' });
});


bot.onText(/\/book/, (msg) => {
  const chatId = msg.chat.id;
  
  const keyboard = {
    reply_markup: {
      keyboard: [
        [
          {
            text: 'üìã –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –®–æ—É',
            web_app: { url: `${WEBAPP_URL}#booking` }
          }
        ]
      ],
      resize_keyboard: true,
      one_time_keyboard: true
    }
  };

  bot.sendMessage(chatId, 
    'üìã –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', 
    keyboard
  );
});

// –ö–æ–º–∞–Ω–¥–∞ /contact - –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
bot.onText(/\/contact/, (msg) => {
  const chatId = msg.chat.id;
  bot.sendMessage(chatId,
    'üíé *–ö–û–ù–¢–ê–ö–¢–´ FLOW HAMMER SHOP*\n\n' +
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
    'üë§ *Flow Hammer Shop Da Nang*\n' +
    'üõçÔ∏è –ú–∞—Å—Å–∞–∂–Ω—ã–µ –ø–∞–ª–∫–∏ & –ù–∞—à–ª–µ–º–Ω–∏–∫–∏\n\n' +
    'üìß *Email:*\n' +
    '`wellness.shop.dn@gmail.com`\n\n' +
    'üì± *–¢–µ–ª–µ—Ñ–æ–Ω:*\n' +
    '`+84 949197496`\n\n' +
    'üìç *–ê–¥—Ä–µ—Å:*\n' +
    'Da Nang, Vietnam\n\n' +
    'üïê *–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:*\n' +
    '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 09:00 –¥–æ 21:00\n\n' +
    'üí¨ *Telegram Support:*\n' +
    '–û—Ç–≤–µ—Ç–∏–º –≤ —Ç–µ—á–µ–Ω–∏–∏ 1 —á–∞—Å–∞\n\n' +
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
    'üõí –î–ª—è –∑–∞–∫–∞–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É `/book`\n' +
    '‚≠ê –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–¥ *WELCOME10* –¥–ª—è —Å–∫–∏–¥–∫–∏ 10%\n' +
    'üåê –ü–æ—Å–µ—Ç–∏ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω —á–µ—Ä–µ–∑ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
    { parse_mode: 'Markdown' }
  );
});

// –ö–æ–º–∞–Ω–¥–∞ /logs - –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
bot.onText(/\/logs/, (msg) => {
  const chatId = msg.chat.id;
  
  if (messageLogs.length === 0) {
    bot.sendMessage(chatId, 'üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –ª–æ–≥–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π');
    return;
  }
  
  const recentLogs = messageLogs.slice(-10).reverse();
  let logsText = `üìä *–ü–æ—Å–ª–µ–¥–Ω–∏–µ ${recentLogs.length} —Å–æ–æ–±—â–µ–Ω–∏–π:*\n\n`;
  
  recentLogs.forEach((log, index) => {
    logsText += `${index + 1}. üìÖ ${new Date(log.timestamp).toLocaleString()}\n`;
    logsText += `   üí¨ –ö–∞–Ω–∞–ª: ${log.chatTitle}\n`;
    logsText += `   üë§ –û—Ç: @${log.userName}\n`;
    logsText += `   üìù –¢–∏–ø: ${log.messageType}\n`;
    logsText += `   üí≠ –¢–µ–∫—Å—Ç: ${log.text.substring(0, 50)}${log.text.length > 50 ? '...' : ''}\n\n`;
  });
  
  logsText += `\n*–í—Å–µ–≥–æ –ª–æ–≥–æ–≤ –≤ –ø–∞–º—è—Ç–∏: ${messageLogs.length}*`;
  
  bot.sendMessage(chatId, logsText, { parse_mode: 'Markdown' });
});

// –ö–æ–º–∞–Ω–¥–∞ /logs-clear - –æ—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
bot.onText(/\/logs-clear/, (msg) => {
  const chatId = msg.chat.id;
  const clearedCount = messageLogs.length;
  
  messageLogs.length = 0;
  
  bot.sendMessage(chatId, 
    `üóëÔ∏è *–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã!*\n\n` +
    `–£–¥–∞–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${clearedCount}`,
    { parse_mode: 'Markdown' }
  );
});

// –ö–æ–º–∞–Ω–¥–∞ /status - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
bot.onText(/\/status/, (msg) => {
  const chatId = msg.chat.id;
  const isAdmin = msg.from.id === 0; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –∞–¥–º–∏–Ω–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  
  let status = `ü§ñ *–°—Ç–∞—Ç—É—Å Flow Hammer Shop Bot*\n\n`;
  status += `üìä –í—Å–µ–≥–æ –ª–æ–≥–æ–≤ –≤ –ø–∞–º—è—Ç–∏: ${messageLogs.length}\n`;
  status += `üí¨ –¢–∏–ø —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞: ${msg.chat.type}\n`;
  status += `üìç Chat ID: ${msg.chat.id}\n\n`;
  status += `‚ÑπÔ∏è *–í–ê–ñ–ù–û!*\n`;
  status += `–ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑:\n`;
  status += `‚úÖ –°—É–ø–µ—Ä–≥—Ä—É–ø–ø (supergroup)\n`;
  status += `‚úÖ –û–±—ã—á–Ω—ã—Ö –≥—Ä—É–ø–ø (group)\n`;
  status += `‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (private)\n`;
  status += `‚úÖ –ü—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (channel) - –µ—Å–ª–∏ –±–æ—Ç –∞–¥–º–∏–Ω\n\n`;
  status += `‚ö†Ô∏è *–ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç:*\n`;
  status += `1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª/–≥—Ä—É–ø–ø—É\n`;
  status += `2. –í –∫–∞–Ω–∞–ª–∞—Ö - –±–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–æ–º\n`;
  status += `3. –£–±–µ–¥–∏—Å—å —á—Ç–æ –ª—é–¥–∏ –ø–∏—à—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è`;
  
  bot.sendMessage(chatId, status, { parse_mode: 'Markdown' });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∫–Ω–æ–ø–æ–∫
bot.on('callback_query', (query) => {
  const chatId = query.message.chat.id;
  const userId = query.from.id;
  const userName = query.from.username || `${query.from.first_name} ${query.from.last_name}`.trim();
  
  console.log(`\nüîò CALLBACK QUERY –ü–û–õ–£–ß–ï–ù–ê`);
  console.log('‚îÄ'.repeat(60));
  console.log(`üë§ –û—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: @${userName} (ID: ${userId})`);
  console.log(`üìç Chat ID: ${chatId}`);
  console.log(`üîò –ö–Ω–æ–ø–∫–∞ (callback_data): ${query.data}`);
  console.log('‚îÄ'.repeat(60));
  
  switch(query.data) {
    case 'products_list':
      console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞: products_list');
      bot.answerCallbackQuery(query.id);
      
      // Send the same products message as /products command
      const productsMessage = 
        'üõçÔ∏è *–¢–†–ò –ó–í–ï–ó–î–´ –ù–ê–®–ï–ì–û –ú–ê–ì–ê–ó–ò–ù–ê*\n\n' +
        '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
        'üßä *–ö–û–ú–ü–ê–ö–¢–ù–ê–Ø: Mini Pocket (12.99$)*\n' +
        'üìè –î–ª–∏–Ω–∞: 10 —Å–º ‚Äî –≤ —Å—É–º–∫—É, –≤ –∫–∞—Ä–º–∞–Ω\n' +
        '‚ú® –ò–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è: –æ—Ñ–∏—Å–∞, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π, –±—ã—Å—Ç—Ä—ã—Ö —Å–µ—Å—Å–∏–π\n' +
        'üí™ –ú–∞—Ç–µ—Ä–∏–∞–ª: –ø–ª–∞—Å—Ç–∏–∫ ABS + —Å–∏–ª–∏–∫–æ–Ω\n' +
        '‚≠ê –¢–µ—Ö–Ω–∏–∫–∞: —É–¥–æ–±–Ω–∞—è –≤ –ª–∞–¥–æ–Ω–∏\n\n' +
        'üíÜ *–°–†–ï–î–ù–Ø–Ø: Therapy Ergonomic (24.99$)*\n' +
        'üìè –î–ª–∏–Ω–∞: 30 —Å–º ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è\n' +
        '‚ú® –ò–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è: –¥–æ–º–∞, —Å–ø–æ—Ä—Ç–∑–∞–ª–∞, –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n' +
        'üí™ –ú–∞—Ç–µ—Ä–∏–∞–ª: –≥–∏–±–∫–∏–π –∫–æ—Ä–ø—É—Å + –º—è–≥–∫–∏–π –Ω–∞–∫–æ–Ω–µ—á–Ω–∏–∫\n' +
        '‚≠ê –¢–µ—Ö–Ω–∏–∫–∞: —Ç–æ—á–Ω–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ —Ç—Ä–∏–≥–≥–µ—Ä-—Ç–æ—á–∫–∏\n\n' +
        'ü•á *–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø: Acupressure Pro (19.99$)*\n' +
        'üìè –î–ª–∏–Ω–∞: 45 —Å–º ‚Äî –¥–ª—è —Å–µ—Ä—å—ë–∑–Ω–æ–π —Ä–∞–±–æ—Ç—ã\n' +
        '‚ú® –ò–¥–µ–∞–ª—å–Ω–∞ –¥–ª—è: –≥–ª—É–±–æ–∫–æ–≥–æ –º–∞—Å—Å–∞–∂–∞, —Å–ø–∏–Ω—ã, –Ω–æ–≥\n' +
        'üí™ –ú–∞—Ç–µ—Ä–∏–∞–ª: —Ö–∞—Ä–¥–∫–æ—Ä–Ω—ã–π ABS + –∂—ë—Å—Ç–∫–∏–π —Å–∏–ª–∏–∫–æ–Ω\n' +
        '‚≠ê –¢–µ—Ö–Ω–∏–∫–∞: —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è –∞–∫—É–ø—Ä–µ—Å—Å—É—Ä–∞\n\n' +
        '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
        'üéØ *–ü–õ–Æ–°: Character Helmet Cover (8.99$)*\n' +
        'üòä –ú–∏–ª—ã–π –¥–∏–∑–∞–π–Ω full-face –¥–ª—è –º–æ—Ç–æ—Ü–∏–∫–ª–∏—Å—Ç–æ–≤\n' +
        'üõ°Ô∏è –ó–∞—â–∏—Ç–∞ —à–ª–µ–º–∞ + —Å—Ç–∏–ª—å –Ω–∞ —Ñ–æ—Ç–æ\n\n' +
        '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
        '‚úÖ *3000+ –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤*\n' +
        '‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ 30 –¥–Ω–µ–π\n' +
        '‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑\n\n' +
        '–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É!';
      
      const keyboard = {
        reply_markup: {
          inline_keyboard: [
            [
              {
                text: 'üõí –û—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω',
                web_app: { url: `${WEBAPP_URL}#products` }
              }
            ]
          ]
        }
      };

      console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é —Ç–æ–≤–∞—Ä—ã...');
      bot.sendMessage(chatId, productsMessage, { parse_mode: 'Markdown', ...keyboard });
      
      // Send helmet cover image
      console.log('üì∏ –û—Ç–ø—Ä–∞–≤–ª—è—é —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞...');
      try {
        const helmetImageUrl = 'https://picsum.photos/400/400?random=' + Date.now();
        bot.sendPhoto(chatId, helmetImageUrl, {
          caption: 'üß∏ *Character Helmet Cover - –°—Ç–∏–ª—å & –ó–∞—â–∏—Ç–∞*\nüíô –ú–∏–ª—ã–π –¥–∏–∑–∞–π–Ω | ‚ú® –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ\nüèçÔ∏è –î–ª—è –º–æ—Ç–æ—Ü–∏–∫–ª–∏—Å—Ç–æ–≤ | üí∞ 8.99$',
          parse_mode: 'Markdown'
        }).then(msg => {
          console.log('‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (ID: ' + msg.photo[0].file_id + ')');
        }).catch(err => {
          console.error('‚ùå –û—à–∏–±–∫–∞ —Ñ–æ—Ç–æ:', err.message);
        });
      } catch (e) {
        console.error('‚ùå Exception:', e.message);
      }
      break;
      
    case 'shows_info':
      console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞: shows_info');
      bot.answerCallbackQuery(query.id);
      const showsMessage = 
        'üõçÔ∏è *–¢–†–ò –ó–í–ï–ó–î–´ –ù–ê–®–ï–ì–û –ú–ê–ì–ê–ó–ò–ù–ê*\n\n' +
        '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
        'üßä *–ö–û–ú–ü–ê–ö–¢–ù–ê–Ø: Mini Pocket (12.99$)* ‚Äî 10 —Å–º\n' +
        '‚ú® –ö–∞—Ä–º–∞–Ω, —Å–ø–µ—à–∫–∞, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è\n\n' +
        'üíÜ *–°–†–ï–î–ù–Ø–Ø: Therapy Ergonomic (24.99$)* ‚Äî 30 —Å–º\n' +
        '‚ú® –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞, —Å–ø–æ—Ä—Ç–∑–∞–ª, –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–µ\n\n' +
        'ü•á *–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø: Acupressure Pro (19.99$)* ‚Äî 45 —Å–º\n' +
        '‚ú® –ì–ª—É–±–æ–∫–∏–π –º–∞—Å—Å–∞–∂, —Å–ø–∏–Ω–∞, –Ω–æ–≥–∏\n\n' +
        'üéØ *–ü–õ–Æ–°: Character Helmet Cover (8.99$)*\n' +
        'üòä –§–∏—Ä–º–µ–Ω–Ω—ã–π –Ω–∞—à–ª–µ–º–Ω–∏–∫ –¥–ª—è –º–æ—Ç–æ—Ü–∏–∫–ª–∏—Å—Ç–æ–≤\n\n' +
        '‚úÖ –ü–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑: –ø—Ä–æ–º–æ–∫–æ–¥ WELCOME10 = ‚àí10%\n' +
        '‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞ –æ—Ç 50$';
      console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–∞—Ö...');
      bot.sendMessage(chatId, showsMessage, { parse_mode: 'Markdown' })
        .then(() => console.log('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–≤–∞—Ä–∞—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'))
        .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', err));
      break;
      
    case 'contact_info':
      console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞: contact_info');
      bot.answerCallbackQuery(query.id);
      console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é...');
      bot.sendMessage(
        chatId,
        'üíé *–ö–û–ù–¢–ê–ö–¢–´ FLOW HAMMER SHOP*\n\n' +
        '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
        'üë§ *Flow Hammer Shop Da Nang*\n' +
        'üõçÔ∏è –õ—É—á—à–∏–µ –º–∞—Å—Å–∞–∂–Ω—ã–µ –ø–∞–ª–∫–∏ –í—å–µ—Ç–Ω–∞–º–∞\n\n' +
        'üìß *Email:*\n' +
        '`wellness.shop.dn@gmail.com`\n\n' +
        'üì± *–¢–µ–ª–µ—Ñ–æ–Ω:*\n' +
        '`+84 949197496`\n\n' +
        'üìç *–ê–¥—Ä–µ—Å:*\n' +
        'Da Nang, Vietnam\n\n' +
        'üïê *–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:*\n' +
        '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 09:00 –¥–æ 21:00\n\n' +
        '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n' +
        'üõí –î–ª—è –∑–∞–∫–∞–∑–∞: /book\n' +
        'üíé –î–æ–≤–µ—Ä–∏–µ, –∫–∞—á–µ—Å—Ç–≤–æ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üí™',
        { parse_mode: 'Markdown' }
      )
        .then(() => console.log('‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã'))
        .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', err));
      break;
      
    case 'book_show':
      bot.answerCallbackQuery(query.id, { text: 'ÔøΩ –û—Ç–∫—Ä–æ–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞...' });
      const bookingKeyboard = {
        reply_markup: {
          inline_keyboard: [
            [
              {
                text: 'üõí –ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–∫–∞–∑—É',
                web_app: { url: `${WEBAPP_URL}#booking` }
              }
            ]
          ]
        }
      };
      bot.sendMessage(chatId, '–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑:', bookingKeyboard);
      break;
      
    case 'about':
      bot.answerCallbackQuery(query.id);
      const aboutKeyboard = {
        reply_markup: {
          inline_keyboard: [
            [
              {
                text: 'üåê –ë–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏',
                web_app: { url: WEBAPP_URL }
              }
            ]
          ]
        }
      };
      bot.sendMessage(chatId, 
        'üíé *FLOW HAMMER SHOP DA NANG*\n\n' +
        '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–∞—Å—Å–∞–∂–Ω—ã–µ –ø–∞–ª–∫–∏ + –§–∏—Ä–º–µ–Ω–Ω—ã–π –Ω–∞—à–ª–µ–º–Ω–∏–∫\n\n' +
        '‚ú® 3 —Ö–µ–¥–ª–∞–π–Ω–µ—Ä–∞ –ø–æ –¥–ª–∏–Ω–µ (10—Å–º, 30—Å–º, 45—Å–º)\n' +
        'üí™ –î–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤, –π–æ–≥–æ–≤, –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤\n' +
        'üèÜ 3000+ –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\n\n' +
        '–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞:\n' +
        '‚úÖ 30-–¥–Ω–µ–≤–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è\n' +
        '‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –æ—Ç 50$\n' +
        '‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n' +
        '‚úÖ –°–µ—Ç—å 4* –æ—Ç–∑—ã–≤–æ–≤',
        { parse_mode: 'Markdown', ...aboutKeyboard }
      )
        .then(() => console.log('‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞'))
        .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', err));
      break;
      
    default:
      console.log(`‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞: ${query.data}`);
      bot.answerCallbackQuery(query.id, { text: '‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞' });
      break;
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
bot.on('polling_error', (error) => {
  console.log('‚ùå –û—à–∏–±–∫–∞ polling:', error);
});

bot.on('error', (error) => {
  console.log('‚ùå –û—à–∏–±–∫–∞ –±–æ—Ç–∞:', error);
});

console.log('‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π /help –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏.');


